<!-- <div class="card-body border-bottom">
            <div class="d-flex align-items-center">
              <h5 class="mb-0 card-title flex-grow-1">
                Detalle de la solicitud: {{ solicitudCompra.folio }}
              </h5>
              
            </div>
          </div> -->
<div class="card-body border-bottom">
  <div class="row">
    <div class="col-md-6">
      <p><strong>Folio: </strong>{{ solicitudCompra.folio }}</p>
      <p>
        <strong>Usuario solicita: </strong
        >{{ solicitudCompra.usuario_solicita }}
      </p>
      <p><strong>Empresa: </strong>CAS</p>
    </div>
    <div class="col-md-6">
      <p><strong>Fecha: </strong>{{ solicitudCompra.fecha }}</p>
      <p>
        <strong>Usuario Destino: </strong>{{ solicitudCompra.usuario_destino }}
      </p>
      <p><strong>Motivo: </strong>{{ solicitudCompra.motivo }}</p>
    </div>
    <div *ngIf="mostrarTotal" class="row"></div>
  </div>
  <div class="d-flex justify-content-center" *ngIf="isLoad">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>
  <table
    class="table table-striped table-hover table-sm table-bordered table-responsive"
    id="tableCompraInsumos"
    *ngIf="!isLoad"
  >
    <thead class="table-light">
      <tr>
        <th>Cantidad</th>
        <th>Unidad de Medida</th>
        <th>Descripción</th>
        <th>Observaciones</th>
        <th>Ref. fotográfica</th>
        <th *ngFor="let prov of cotProv" class="text-center">
          <strong> {{ prov.proveedores_id[0].nombre }} </strong>
        </th>
      </tr>
    </thead>
    <tbody>
      <!-- datos de la tabla detalle -->
      <tr *ngFor="let row of detalles; let i = index">
        <td class="text-center">{{ row.cantidad }}</td>
        <td>
          {{ row.unidadMedida.nombre }} ({{ row.unidadMedida.abreviatura }})
        </td>
        <td>{{ row.descripcion }}</td>
        <td>{{ row.observaciones }}</td>
        <td>
          <a
            *ngIf="row.img_referencia"
            href="javascript:void(0);"
            class="btn btn-info btn-sm"
            (click)="openModal(content, row.img_referencia)"
          >
            <i class="fas fa-eye"></i
          ></a>
        </td>
        <td *ngFor="let prov of cotProv; let i = index">
          <!-- <td *ngFor="let prov of row.detalles"> -->
          <div class="input-group col-sm-1">
            <span class="input-group-text">$</span>
            <input
              type="text"
              [(ngModel)]="row['precio_' + prov.proveedores_id[0].id]"
              (input)="validateNumberInput($event)"
              placeholder="Precio"
              class="form-control"
              [disabled]="row['disabled_' + +prov.proveedores_id[0].id]"
              (input)="updateTotals()"
            />
          </div>
        </td>
      </tr>
    </tbody>
    <tfoot>
      <tr *ngIf="mostrarTotal">
        <td colspan="5" class="text-end"><Strong>SUB-TOTAL (sin iva)</Strong></td>
        <td *ngFor="let prov of cotProv" 
        [ngClass]="{'bg-success text-white': totals['precio_' + prov.proveedores_id[0].id] === totalMasBajo}"
        class="text-center">
          <strong>
            {{ totals["precio_" + prov.proveedores_id[0].id] | currency }}
          </strong>
        </td>
      </tr>
    </tfoot>
  </table>
  
  

  <div *ngIf="mostrarTotal" class="row">
    <p *ngIf="cotizacion"><strong>Consideraciones: </strong> {{ cotizacion.consideraciones }}</p>
    <div  class="alert alert-warning text-center" role="alert">
      Marca la casilla de la fila con el proveedor seleccionado para generar la orden de compra
    </div>
    <div class="col-10">
      <table class="table table-striped table-hover table-sm table-bordered table-responsive">
  
        <thead class="table-light">
          <tr class="text-center">
            <th *ngIf="solicitudCompra.estatus === 2">#</th>
            <th>Nombre proveedor</th>
            <th>Archivo cotización </th>
          </tr>
        </thead>
        
        <tbody>
          <tr *ngFor="let prov of cotProv; let i = index" class="text-center">
            <td *ngIf="solicitudCompra.estatus === 2" > 
              <div    class="col align-self-center">
              <input 
              *ngIf="prov.ruta"
              (change) = "manejoCheck(prov)"
              name="radioProveedor" 
              class="form-check-input" 
              type="radio"
              >
            </div>
           </td>
            <td > {{ prov.proveedores_id[0].nombre }} </td>
            <td>  
              <div>
              <input
              *ngIf="!prov.ruta"
                (change)="onFileChange($event, prov.id)"
                class="form-control form-control-sm"
                id="prov.id"
                name="prov.id"
                type="file"
              />
              <a
                class="btn btn-sm btn-danger"
                *ngIf="prov.ruta"
                (click)="verArchivos(prov.ruta)"
              >
                <i class="fas fa-file-pdf"></i>
              </a>
            </div>
          </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="col-2 d-flex align-items-start">
      <button
        *ngIf="solicitudCompra.estatus === 2"
        type="submit"
        class="btn btn-sm btn-success"
        (click)="guardarPrecios()"
      >
        Guardar Cotización
      </button>
    </div>
    <hr />
    
  </div>
  <button *ngIf="solicitudCompra.estatus === 3" class="btn btn-sm btn-primary" (click)="descargarOrden()">
    <i class="fas fa-file-download"></i> Descargar Orden de Compra
  </button>
  <div *ngIf="mostrarCotizacionFlag">
    <div class="alert alert-info" style="text-align: center" role="alert">
      Seleccione los proveedores a los que se le solicitara la cotización
    </div>

    <form class="row g-2" [formGroup]="formSolicitudCotizacion">
      <div class="col-md-4">
        <label for="empresa1" class="form-label form-label-sm"
          >Proveedor 1: *</label
        >
        <select
          class="form-select form-select-sm"
          formControlName="empresa1"
          id="empresa1"
          aria-label="Default select example"
          (change)="onSelectChange($event.target.value, 0)"
        >
          <option *ngFor="let item of proveedores" [value]="item.id">
            {{ item.nombre }}
          </option>
        </select>
        <div
          *ngIf="solicitudCotizacionFormControl.empresa1.touched || submitted"
        >
          <div
            class="text-danger form-text"
            *ngIf="solicitudCotizacionFormControl.empresa1.errors?.['required']"
          >
            Selecciona un proveedor
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <label for="empresa2" class="form-label form-label-sm"
          >Proveedor 2: *</label
        >
        <select
          class="form-select form-select-sm"
          formControlName="empresa2"
          id="empresa2"
          aria-label="Default select example"
          (change)="onSelectChange($event.target.value, 1)"
        >
          <option *ngFor="let item of proveedores" [value]="item.id">
            {{ item.nombre }}
          </option>
        </select>
        <div
          *ngIf="solicitudCotizacionFormControl.empresa2.touched || submitted"
        >
          <div
            class="text-danger form-text"
            *ngIf="solicitudCotizacionFormControl.empresa2.errors?.['required']"
          >
            Selecciona un proveedor
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <label for="empresa3" class="form-label form-label-sm"
          >Proveedor 3: *</label
        >
        <select
          class="form-select form-select-sm"
          formControlName="empresa3"
          id="empresa3"
          aria-label="Default select example"
          (change)="onSelectChange($event.target.value, 2)"
        >
          <option *ngFor="let item of proveedores" [value]="item.id">
            {{ item.nombre }}
          </option>
        </select>
        <div
          *ngIf="solicitudCotizacionFormControl.empresa3.touched || submitted"
        >
          <div
            class="text-danger form-text"
            *ngIf="solicitudCotizacionFormControl.empresa3.errors?.['required']"
          >
            Selecciona un proveedor
          </div>
        </div>
      </div>

      <div class="col-md-12">
        <label for="consideraciones" class="form-label"
          >Consideraciones: *</label
        >
        <textarea
          class="form-control"
          formControlName="consideraciones"
          id="consideraciones"
          rows="3"
        ></textarea>
        <div
          *ngIf="
            solicitudCotizacionFormControl.consideraciones.touched || submitted
          "
        >
          <div
            class="text-danger form-text"
            *ngIf="solicitudCotizacionFormControl.consideraciones.errors?.['required']"
          >
            Consideraciones es requerido.
          </div>
        </div>
      </div>
      <div class="col-sm-2">
        <button
          class="btn btn-sm btn-primary"
          type="button"
          (click)="enviarSolicitudCotizacion()"
          [disabled]="isDisabled"
        >
          <div *ngIf="!isDisabled">Solicitar Cotización</div>
          <div *ngIf="isDisabled">
            Trabajando
            <div class="spinner-grow spinner-grow-sm" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
        </button>
      </div>
    </form>
  </div>
</div>
<!-- termina card body -->
<!-- Modal -->
<ng-template #content let-modal>
  <div class="modal-header">
    <h5 class="modal-title" id="exampleModalLabel">Img. referencia</h5>
    <button
      type="button"
      class="btn-close"
      data-bs-dismiss="modal"
      aria-label="Close"
      id="close-modal"
      (click)="modalRef?.hide()"
    ></button>
  </div>
  <div class="modal-body">
    <img
      [src]="selectedImage"
      class="img-fluid rounded"
      style="max-width: 100%; height: auto"
      alt="Imagen de referencia"
    />
  </div>
  <div class="modal-footer">
    <button
      type="button"
      class="btn btn-secondary btn-sm"
      data-bs-dismiss="modal"
      (click)="modalRef?.hide()"
    >
      Cerrar
    </button>
  </div>
</ng-template>
